<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Code Review Bot</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" rel="stylesheet"/>
  <style>
    :root {
      --bg-color: #f4f4f4;
      --text-color: #333;
      --card-bg: #fff;
      --btn-bg: #007bff;
      --btn-hover: #0056b3;
      --sidebar-bg: #eee;
    }
    [data-theme="dark"] {
      --bg-color: #121212;
      --text-color: #eee;
      --card-bg: #1e1e1e;
      --btn-bg: #0d6efd;
      --btn-hover: #084298;
      --sidebar-bg: #1a1a1a;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      display: flex;
      min-height: 100vh;
      transition: all 0.3s;
    }

    /* Sidebar */
    .sidebar {
      width: 220px;
      background-color: var(--sidebar-bg);
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }
    .sidebar h3 {
      margin-top: 0;
    }
    .recent-item {
      cursor: pointer;
      padding: 5px 8px;
      border-radius: 4px;
      margin-bottom: 5px;
    }
    .recent-item:hover {
      background-color: var(--btn-bg);
      color: white;
    }

    /* Main content */
    .main {
      flex: 1;
      padding: 20px;
      box-sizing: border-box;
    }

    h1 {
      margin-top: 0;
    }

    .theme-toggle {
      background-color: var(--btn-bg);
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 5px;
      cursor: pointer;
      margin-bottom: 15px;
    }

    textarea {
      width: 100%;
      height: 180px;
      padding: 10px;
      font-family: monospace;
      border-radius: 6px;
      border: 1px solid #ccc;
      background-color: var(--card-bg);
      color: var(--text-color);
      resize: vertical;
    }

    button {
      background-color: var(--btn-bg);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
      transition: 0.2s;
    }
    button:hover {
      background-color: var(--btn-hover);
    }

    .card {
      background-color: var(--card-bg);
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: all 0.3s;
      overflow-x: auto;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--btn-bg);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    @keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}
  </style>
</head>
<body data-theme="light">
  <div class="sidebar">
    <h3>Recent Searches</h3>
    <div id="recentList"></div>
    <button class="theme-toggle" onclick="toggleTheme()">üåô Dark Mode</button>
  </div>

  <div class="main">
    <h1>ü§ñ AI Code Review Bot</h1>
    <textarea id="codeInput" placeholder="Paste your code here..."></textarea><br>
    <button onclick="reviewCode()">Review Code</button>
    <div id="output"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-python.min.js"></script>
  <script>
    const recent = [];

    function toggleTheme() {
      const body = document.body;
      const btn = document.querySelector('.theme-toggle');
      if (body.getAttribute('data-theme') === 'light') {
        body.setAttribute('data-theme', 'dark');
        btn.textContent = '‚òÄÔ∏è Light Mode';
      } else {
        body.setAttribute('data-theme', 'light');
        btn.textContent = 'üåô Dark Mode';
      }
    }

    function updateRecentList() {
      const list = document.getElementById('recentList');
      list.innerHTML = '';
      recent.slice().reverse().forEach((item) => {
        const div = document.createElement('div');
        div.textContent = item.keyword;
        div.className = 'recent-item';
        div.onclick = () => document.getElementById('codeInput').value = item.code;
        list.appendChild(div);
      });
    }

    async function reviewCode() {
      const code = document.getElementById('codeInput').value.trim();
      const output = document.getElementById('output');

      if (!code) {
        output.innerHTML = `<div class="card" style="color:red;">‚ö†Ô∏è Please paste your code first!</div>`;
        return;
      }

      // Generate keyword for recent searches
      let keyword = "Untitled snippet";
      try {
        const response = await fetch("/keyword", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ code })
        });
        const data = await response.json();
        if (data.keyword) keyword = data.keyword;
      } catch (err) {
        console.error("Keyword generation error:", err);
      }

      // Add to recent list
      recent.push({ keyword, code });
      updateRecentList();

      output.innerHTML = `<div class="card"><div class="spinner"></div><p style="text-align:center;">‚è≥ Reviewing your code...</p></div>`;

      try {
        const response = await fetch("/review", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ code })
        });
        const data = await response.json();

        if (data.review) {
          output.innerHTML = `
            <div class="card">
              <h3>üí° AI Review Feedback:</h3>
              <pre><code class="language-python">${data.review}</code></pre>
            </div>`;
          Prism.highlightAll();
        } else {
          output.innerHTML = `<div class="card" style="color:red;">Error: ${data.error}</div>`;
        }
      } catch (err) {
        output.innerHTML = `<div class="card" style="color:red;">‚ùå Server error: ${err.message}</div>`;
      }
    }
  </script>
</body>
</html>
